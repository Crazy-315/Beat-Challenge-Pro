<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ™ï¸ æ™ºèƒ½å£è¯­ç‹ Â· å‡†åº¦è¯„åˆ†ç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root { --score-color: #ffde9e; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: radial-gradient(circle at center, #1a2f3a 0%, #0b1c26 100%);
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Segoe UI', system-ui, sans-serif; color: white;
        }

        /* å¯åŠ¨é®ç½© */
        #startOverlay {
            position: fixed; inset: 0; background: rgba(11, 28, 38, 0.98);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; text-align: center; padding: 20px;
        }
        .start-btn {
            background: #ffde9e; color: #0b1c26; border: none; padding: 25px 50px;
            border-radius: 50px; font-size: 2rem; font-weight: 800; cursor: pointer;
            box-shadow: 0 10px 30px rgba(255, 222, 158, 0.3); transition: 0.3s;
        }
        .start-btn:hover { transform: scale(1.05); background: #fff; }

        .game-card {
            width: 90%; max-width: 600px; background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px); border-radius: 40px; padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 40px 60px rgba(0,0,0,0.5);
        }

        /* åˆ†æ•°ç¯ */
        .score-circle {
            width: 120px; height: 120px; border-radius: 50%; border: 8px solid #12303e;
            margin: 0 auto 20px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; position: relative;
            transition: 0.5s; border-top-color: var(--score-color);
        }
        .score-val { font-size: 2.2rem; font-weight: 800; color: var(--score-color); }
        .score-label { font-size: 0.8rem; color: #6a9bb5; }

        .word-display {
            text-align: center; margin: 20px 0; padding: 30px;
            background: rgba(0,0,0,0.2); border-radius: 30px;
        }
        #wordIcon { font-size: 6rem; margin-bottom: 10px; display: block; }
        #currentWord { font-size: 4.5rem; font-weight: 900; letter-spacing: 3px; color: #fff; }

        .mic-active {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            color: #4faa6a; margin-bottom: 20px; font-size: 0.9rem;
        }
        .dot { width: 8px; height: 8px; background: #4faa6a; border-radius: 50%; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .status-box {
            height: 60px; text-align: center; color: #b4d6ea; font-size: 1.2rem;
            display: flex; align-items: center; justify-content: center;
        }

        .success-flash { animation: successHit 0.5s ease-out; }
        @keyframes successHit {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); background: rgba(79, 170, 106, 0.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <div id="startOverlay">
        <h1>ğŸ™ï¸ å£è¯­å‡†åº¦å¤§æŒ‘æˆ˜</h1>
        <p style="margin-bottom: 30px; color: #6a9bb5;">è¯·ç¡®ä¿ç¯å¢ƒå®‰é™ï¼Œå¹¶ä½¿ç”¨ HTTPS è®¿é—®</p>
        <button class="start-btn" id="startBtn">å¼€å§‹æŒ‘æˆ˜</button>
    </div>

    <div class="game-card">
        <div class="score-circle" id="scoreCircle">
            <span class="score-val" id="lastScore">--</span>
            <span class="score-label">å‡†åº¦å¾—åˆ†</span>
        </div>

        <div class="mic-active" id="micIndicator">
            <div class="dot"></div> æ­£åœ¨ç›‘å¬æ‚¨çš„å‘éŸ³...
        </div>

        <div class="word-display" id="mainDisplay">
            <span id="wordIcon">ğŸ</span>
            <span id="currentWord">APPLE</span>
        </div>

        <div class="status-box" id="statusMsg">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>
        
        <div style="text-align:center; color: #6a9bb5; font-size: 0.8rem; margin-top: 20px;">
            ç³»ç»Ÿè¯†åˆ«åˆ°å…³é”®è¯å°†è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é¢˜
        </div>
    </div>

<script>
    const QUIZ = [
        {w:'apple', i:'ğŸ'}, {w:'banana', i:'ğŸŒ'}, {w:'cake', i:'ğŸ°'}, 
        {w:'dog', i:'ğŸ¶'}, {w:'elephant', i:'ğŸ˜'}, {w:'fish', i:'ğŸŸ'}, 
        {w:'guitar', i:'ğŸ¸'}, {w:'house', i:'ğŸ '}
    ];

    let index = 0;
    let recognition;
    let isRunning = false;

    const lastScoreEl = document.getElementById('lastScore');
    const wordEl = document.getElementById('currentWord');
    const iconEl = document.getElementById('wordIcon');
    const statusEl = document.getElementById('statusMsg');
    const displayCard = document.getElementById('mainDisplay');

    function initSpeech() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            statusEl.textContent = "âŒ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«";
            return;
        }

        recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.continuous = false; // é‡‡ç”¨å•æ¬¡è¯†åˆ«åé‡å¯ï¼Œæ›´æ˜“æ§åˆ¶
        recognition.interimResults = false;

        recognition.onresult = (event) => {
            const resultObj = event.results[0][0];
            const transcript = resultObj.transcript.toLowerCase().trim();
            const confidence = resultObj.confidence; // 0 åˆ° 1 ä¹‹é—´çš„æ•°å€¼
            
            // å°†ç½®ä¿¡åº¦æ˜ å°„ä¸ºåˆ†æ•° (é€šå¸¸ API è¿”å›çš„ confidence åœ¨ 0.8 ä»¥ä¸Šå°±å¾ˆæ¸…æ™°äº†)
            // æˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„ç®—æ³•ï¼š(confidence * 100) å¹¶æ ¹æ®ç»“æœå¾®è°ƒ
            let score = Math.round(confidence * 100);
            if (score > 95) score = 100; // ç»™ä¸ªåŠæ ¼é¼“åŠ±

            const target = QUIZ[index].w.toLowerCase();
            
            if (transcript.includes(target)) {
                handleMatch(score, transcript);
            } else {
                statusEl.innerHTML = `å¬åˆ°: "${transcript}" (ä¸åŒ¹é…)`;
            }
        };

        // æ ¸å¿ƒï¼šè‡ªåŠ¨é‡å¯ç›‘å¬
        recognition.onend = () => { if (isRunning) recognition.start(); };
        recognition.onerror = (e) => { console.log('Speech Error:', e.error); };
    }

    function handleMatch(score, heard) {
        lastScoreEl.textContent = score;
        statusEl.innerHTML = `âœ… è¯†åˆ«æ­£ç¡®: "<b>${heard}</b>"`;
        displayCard.classList.add('success-flash');

        // é¢œè‰²åé¦ˆï¼šåˆ†æ•°è¶Šé«˜è¶Šäº®
        const hue = Math.min(score, 100); 
        document.documentElement.style.setProperty('--score-color', `hsl(${hue}, 70%, 70%)`);

        // åœæ­¢ç›‘å¬ä¸€å°ä¼šå„¿ï¼Œå‡†å¤‡ä¸‹ä¸€é¢˜
        isRunning = false;
        recognition.stop();

        setTimeout(() => {
            displayCard.classList.remove('success-flash');
            index = (index + 1) % QUIZ.length;
            updateUI();
            isRunning = true;
            recognition.start();
            statusEl.textContent = "è¯·æœ—è¯»ä¸‹ä¸€ä¸ªå•è¯";
        }, 1200);
    }

    function updateUI() {
        wordEl.textContent = QUIZ[index].w.toUpperCase();
        iconEl.textContent = QUIZ[index].i;
    }

    document.getElementById('startBtn').addEventListener('click', () => {
        document.getElementById('startOverlay').style.display = 'none';
        initSpeech();
        isRunning = true;
        recognition.start();
        updateUI();
    });
</script>
</body>
</html>
